<!DOCTYPE html>
<html>
<head>
    <title>Test MP4 Muxer Loading</title>
</head>
<body>
    <h1>Testing mp4-muxer global loading</h1>
    <div id="result">Loading mp4-muxer...</div>

    <!-- Load mp4-muxer via wrapper (like gif.js) -->
    <script type="module" src="libs/mp4-muxer-loader.js"></script>

    <script>
        const resultDiv = document.getElementById('result');

        // Wait for library to load
        window.addEventListener('mp4-muxer-ready', () => {
            console.log('mp4-muxer ready!');

            if (typeof MP4Muxer !== 'undefined' && typeof MP4ArrayBufferTarget !== 'undefined') {
                resultDiv.innerHTML = '✅ SUCCESS: mp4-muxer loaded as globals!<br>' +
                                     'Available: MP4Muxer, MP4ArrayBufferTarget, MP4StreamTarget<br>' +
                                     'This approach works like gif.js!';
                resultDiv.style.color = 'green';

                // Test instantiation
                try {
                    const target = new MP4ArrayBufferTarget();
                    console.log('Created ArrayBufferTarget:', target);
                    resultDiv.innerHTML += '<br><br>✅ Can instantiate ArrayBufferTarget';
                } catch (error) {
                    resultDiv.innerHTML += '<br><br>⚠️ Error creating target: ' + error.message;
                }
            } else {
                resultDiv.innerHTML = '⚠️ Library loaded but globals not available';
                resultDiv.style.color = 'orange';
            }
        });

        window.addEventListener('mp4-muxer-error', (e) => {
            resultDiv.innerHTML = '❌ FAILED to load: ' + e.detail.message;
            resultDiv.style.color = 'red';
            console.error('Load error:', e.detail);
        });

        // Timeout check (in case events don't fire)
        setTimeout(() => {
            if (resultDiv.textContent === 'Loading mp4-muxer...') {
                resultDiv.innerHTML = '⏱️ Timeout: Library did not load within 2 seconds<br>' +
                                     'Check browser console for errors';
                resultDiv.style.color = 'orange';
            }
        }, 2000);
    </script>
</body>
</html>
